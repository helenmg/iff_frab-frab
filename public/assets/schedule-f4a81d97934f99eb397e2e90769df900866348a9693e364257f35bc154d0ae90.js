(function(){var t,e,a,o;a=function(t){var e;e=$(t).data("slot"),$(t).css("position","absolute"),$(t).css("left",e.offset().left),$(t).css("top",e.offset().top)},o=function(t){null==t&&(t=""),$.ajax({url:$("form#update-track").attr("action"),data:{track_id:t},dataType:"html",success:function(t){$("ul#unscheduled-events").html(t)}})},t=function(t,e,o){null==o&&(o=!0),t=$(t),e=$(e),t.data("slot",e),e.append($(t)),a(t),o&&(t.data("time",e.data("time")),t.data("room",e.data("room")),$.ajax({url:t.data("update-url"),data:{event:{start_time:e.data("time"),room_id:e.parents("table.room").data("room-id")}},type:"PUT",dataType:"script",success:function(){t.effect("highlight")}}))},e=function(t){return t.draggable({revert:"invalid",opacity:.4,cursorAt:{left:5,top:5}}),!0},$(function(){var d,n,l,r,s,i,c,u,m,v,f,p,h;for($("body").delegate("div.event","mouseenter",function(){var t,e;t=$(this),t.find("a.close").length>0||(e=$("<a href='#'>\xd7</a>"),e.addClass("close").addClass("small"),t.prepend(e),e.click(function(e){return $.ajax({url:t.data("update-url"),data:{event:{start_time:null,room_id:null}},type:"PUT",dataType:"script",success:function(){t.remove(),o()}}),e.stopPropagation(),e.preventDefault(),!1}))}),$("body").delegate("div.event","mouseleave",function(){$(this).find("a.close").remove()}),$("body").delegate("div.event","click",function(t){return t.stopPropagation(),t.preventDefault(),!1}),m=$("a.toggle-room"),l=0,i=m.length;l<i;l++)d=m[l],$(d).click(function(){var t,e,o,d,n;for(t=$(this),$("table[data-room='"+t.data("room")+"']").toggle(),t.hasClass("success")?t.removeClass("success"):t.addClass("success"),n=$("table.room div.event"),o=0,d=n.length;o<d;o++)e=n[o],a(e);return preventDefault(),!1});for($("a#hide-all-rooms").click(function(){return $("a.toggle-room").removeClass("success"),$("table.room").hide(),!1}),$("select#track_select").change(function(){return o($(this).val()),!0}),v=$("table.room td"),r=0,c=v.length;r<c;r++)h=v[r],$(h).droppable({hoverClass:"event-hover",tolerance:"pointer",drop:function(e,a){return t(a.draggable,this),!0}});for($("#add-event-modal").modal("hide"),$("body").delegate("table.room td","click",function(a){var o;return o=$(this),$("#add-event-modal #current-time").html(o.data("time")),$("ul#unscheduled-events").undelegate("click"),$("ul#unscheduled-events").delegate("li a","click",function(a){var d,n;return d=$(this).parent(),n=$("<div></div>"),n.html(d.children().first().html()),n.addClass("event"),n.attr("id",d.attr("id")),n.css("height",d.data("height")),n.data("update-url",d.data("update-url")),$("#event-pane").append(n),t(n,o),e(n),d.remove(),$("#add-event-modal").modal("hide"),a.preventDefault(),!1}),$("#add-event-modal").modal("show"),a.stopPropagation(),!1}),f=$("div.event"),s=0,u=f.length;s<u;s++)n=f[s],$(n).data("room")&&$(n).data("time")&&(p=$("table[data-room='"+$(n).data("room")+"']").find("td[data-time='"+$(n).data("time")+"']"),t(n,p,!1)),e($(n))})}).call(this);